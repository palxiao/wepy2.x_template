<template>
  <view style="overflow:auto;">
    <canvas canvas-id="canvas" style="width: {{width*ratio*scale}}px; height: {{height*scale}}px"></canvas>
    <button @tap="test2">test</button>
  </view>
</template>
 
<script>
import wepy from '@wepy/core';
// import eventHub from '@/utils/common/eventHub';
import store from '@/store';
// import testMixin from '@/mixins/test';
import api from '@/api';
import SimpleCanvas from 'simple-canvas-posters';

wepy.page({
  store,

  hooks: {
    // Page çº§åˆ« hook, åªå¯¹å½“å‰ Page çš„ setData ç”Ÿæ•ˆã€‚
  },
  //   mixins: [testMixin],
  data: {
    scale: 1,
    width: 375,
    height: 600,
    num: 66,
    ratio: 0,
    temp: '../assets/images/T-00-00.png',
    temp2: ''
  },

  created() {
    this.draw();
  },

  computed: {},

  methods: {
    test2() {
      const _this = this;
      wx.chooseImage({
        count: 1,
        sizeType: ['original', 'compressed'],
        sourceType: ['album', 'camera'],
        success(res) {
          // tempFilePathå¯ä»¥ä½œä¸ºimgæ ‡ç­¾çš„srcå±æ€§æ˜¾ç¤ºå›¾ç‰‡
          const tempFilePaths = res.tempFilePaths;
          console.log(tempFilePaths);
          _this.temp2 = tempFilePaths[0];
          _this.draw();
        }
      });
    },
    draw() {
      const _this = this;
      try {
        const res = wx.getSystemInfoSync();
        this.ratio = res.windowWidth / 375;
      } catch (e) {
        // Do something when catch error
      }

      wx.downloadFile({
        url:
          'https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=281531042,273318123&fm=27&gp=0.jpg', //ä»…ä¸ºç¤ºä¾‹ï¼Œå¹¶éçœŸå®çš„èµ„æº
        success(res) {
          // åªè¦æœåŠ¡å™¨æœ‰å“åº”æ•°æ®ï¼Œå°±ä¼šæŠŠå“åº”å†…å®¹å†™å…¥æ–‡ä»¶å¹¶è¿›å…¥ success å›è°ƒï¼Œä¸šåŠ¡éœ€è¦è‡ªè¡Œåˆ¤æ–­æ˜¯å¦ä¸‹è½½åˆ°äº†æƒ³è¦çš„å†…å®¹
          if (res.statusCode === 200) {
            console.log(res.tempFilePath);
            if(_this.temp2=='') {_this.temp2 = res.tempFilePath;}
          }
        }
      });

      setTimeout(() => {
        const canvas = new SimpleCanvas({
          scale: this.scale,
          canvasId: 'canvas'
        });

        canvas
          .createArtboard({
            id: 'share',
            backgroundColor: '#ffffff',
            width: 375 * this.ratio,
            height: 600
          })

          .drawWrapText({
            id: 'avatar',
            text: '',
            fontSize: 0,
            top: 0
          })

          // .drawWrapText({
          //   id: 'nickname',
          //   fontSize: 16,
          //   text: `è¶…çº§å¤§é­”ç‹~`,
          //   referLayer: {
          //     id: 'avatar',
          //     left: 12,
          //     top: -(canvas.avatar.height / 2 + 8)
          //   }
          // })

          // .drawWrapText({
          //   id: 'time',
          //   fontSize: 12,
          //   color: '#666666',
          //   text: '2019-04-08',
          //   left: 10,
          //   referLayer: {
          //     id: 'avatar',
          //     top: 10
          //   }
          // })

          // .drawWrapText({
          //   id: 'title',
          //   fontSize: 14,
          //   color: '#333333',
          //   text: 'æ³°å›½ğŸ‡¹ğŸ‡­icocoé¦™æ°´å¥¶æ¤°ğŸŒ´',
          //   left: 10,
          //   width: 220 * this.ratio,
          //   referLayer: {
          //     id: 'time',
          //     top: 10
          //   }
          // })

          // .drawWrapText({
          //   id: 'describe',
          //   fontSize: 14,
          //   color: '#333333',
          //   text:
          //     'å¼ºåŠ¿æ˜¥å¤©å¿…å¤‡çš„é™ç‡¥ç¥›ç«ä½³å“ï¼Œå‡€åŒ–è¡€æ¶²ç¥å™¨ï¼Œçˆ†æ¬¾æ¥è¢­ï¼Œç”œåº¦é«˜è¶…çº§å¥½å–ğŸ˜‹',
          //   left: 10,
          //   width: 355 * this.ratio,
          //   lineHeight: 5,
          //   referLayer: {
          //     id: 'title',
          //     top: 10
          //   }
          // })

          .drawImage({
            id: 'bg',
            width: 375 * this.ratio,
            height: 600,
            path: this.temp2,
            referLayer: {
              id: 'avatar',
              top: 10
            }
          })
          .drawImage({
            id: 'preBox',
            left: 20,
            width: 335 * this.ratio,
            height: 560,
            path: this.temp,
            referLayer: {
              id: 'bg',
              top: -580
            }
          })
          .drawWrapText({
            id: 'testText',
            fontSize: 32,
            left: 40,
            text: `æ—…é€”`,
            referLayer: {
              id: 'bg',
              top: -180
            }
          })
          .drawWrapText({
            id: 'testText',
            fontSize: 16,
            left: 40,
            text: `å¼€å§‹æ—…ç¨‹å§ï¼Œä¸ç®¡å‰è·¯åœ¨ä½•æ–¹`,
            referLayer: {
              id: 'bg',
              top: -120
            }
          })

          // .drawWrapText({
          //   id: 'originalPrice',
          //   fontSize: 16,
          //   color: '#666',
          //   text: 'åŸä»·ï¼š ï¿¥ ' + this.num,
          //   left: 10,
          //   width: 200 * this.ratio,
          //   referLayer: {
          //     id: 'image',
          //     top: 10
          //   }
          // })

          // .createRectangle({
          //   id: 'line',
          //   width: 110 * this.ratio,
          //   height: 0.5,
          //   backgroundColor: '#000',
          //   left: 5,
          //   referLayer: {
          //     id: 'originalPrice',
          //     top: -7
          //   }
          // })

          // .drawWrapText({
          //   id: 'price',
          //   fontSize: 20,
          //   color: 'red',
          //   text: 'ç°ä»·ï¼šï¿¥ 18',
          //   left: 10,
          //   width: 200 * this.ratio,
          //   lineHeight: 5,
          //   referLayer: {
          //     id: 'originalPrice',
          //     top: 10
          //   }
          // })

          // .drawImage({
          //   id: 'qrcode',
          //   width: 90 * this.ratio,
          //   height: 90,
          //   path:
          //     'https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=231620273,2622968107&fm=27&gp=0.jpg',
          //   referLayer: {
          //     id: 'image',
          //     top: -90,
          //     left: -90
          //   }
          // });

        // åŠ¨æ€è®¡ç®—canvasé«˜åº¦
        this.height = canvas.getAutoCanvasHeight() + 10;

        canvas.draw();
      }, 1000);
    }
  },
  events: {}
});
</script>
 
<style lang='less' scope>
</style>
<config>
{
navigationBarTitleText: '',
usingComponents: {
 
}
}
</config>